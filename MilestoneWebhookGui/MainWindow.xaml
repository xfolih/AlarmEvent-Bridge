<Window x:Class="MilestoneWebhookGui.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="AlarmEvent Bridge"
        Height="800" Width="1200"
        MinHeight="700" MinWidth="1000"
        WindowStartupLocation="CenterScreen"
        Icon="pack://application:,,,/icon.ico">
    <Window.Resources>
        <Style TargetType="Button">
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="4,2"/>
            <Setter Property="MinWidth" Value="100"/>
        </Style>
    </Window.Resources>
    <Grid Margin="12">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="5"/>
            <ColumnDefinition x:Name="LogColumn" Width="400" MinWidth="0"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- VÃ¤nster panel: Konfiguration -->
        <Grid Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Anslutning -->
            <GroupBox Grid.Row="0" Header="Anslutning till Milestone" Padding="12" Margin="0,0,0,10">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Grid.Column="0" Text="API-adress:" VerticalAlignment="Center" Margin="0,0,12,8" MinWidth="90"/>
                    <TextBox x:Name="TbApiUrl" Grid.Row="0" Grid.Column="1" Margin="0,0,0,8" ToolTip="T.ex. https://localhost eller https://192.168.1.100" MinWidth="200"/>
                    <Button x:Name="BtnDiscover" Grid.Row="0" Grid.Column="2" Margin="8,0,0,8" Click="BtnDiscover_Click" ToolTip="Testar localhost och denna dator">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ”" FontSize="14" Margin="0,0,4,0"/>
                            <TextBlock Text="Prova vanliga adresser"/>
                        </StackPanel>
                    </Button>
                    <TextBlock Grid.Row="1" Grid.Column="0" Text="AnvÃ¤ndarnamn:" VerticalAlignment="Center" Margin="0,0,12,8" MinWidth="90"/>
                    <TextBox x:Name="TbUsername" Grid.Row="1" Grid.Column="1" Margin="0,0,0,8" MinWidth="200"/>
                    <TextBlock Grid.Row="2" Grid.Column="0" Text="LÃ¶senord:" VerticalAlignment="Center" Margin="0,0,12,0" MinWidth="90"/>
                    <PasswordBox x:Name="TbPassword" Grid.Row="2" Grid.Column="1" Margin="0,0,0,0" Padding="6,4" MinWidth="200"/>
                    <StackPanel Grid.Row="1" Grid.RowSpan="2" Grid.Column="2" Orientation="Vertical" VerticalAlignment="Center" Margin="8,0,0,0">
                        <Button x:Name="BtnTestConnection" Click="BtnTestConnection_Click" Margin="0,0,0,4">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="âœ“" FontSize="14" Margin="0,0,4,0"/>
                                <TextBlock Text="Testa anslutning"/>
                            </StackPanel>
                        </Button>
                        <Button x:Name="BtnSaveCredentials" Click="BtnSaveCredentials_Click">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ’¾" FontSize="14" Margin="0,0,4,0"/>
                                <TextBlock Text="Spara uppgifter"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Grid>
            </GroupBox>

            <!-- Webhook-villkor -->
            <GroupBox Grid.Row="1" Header="Webhook-villkor" Padding="12" Margin="0,0,0,10">
                <StackPanel Orientation="Vertical">
                    <CheckBox x:Name="ChkRequireIoActive" Content="KrÃ¤v att larm (IO eller anvÃ¤ndardefinierad hÃ¤ndelse) mÃ¥ste vara aktiv fÃ¶r att skicka webhook vid analyshÃ¤ndelse" IsChecked="True" VerticalAlignment="Center" Margin="0,0,0,4"/>
                    <TextBlock Text="Om avmarkerad: Webhook skickas vid analyshÃ¤ndelse oavsett larmstatus. Om markerad: Webhook skickas endast nÃ¤r analyshÃ¤ndelse OCH larm Ã¤r aktiva." 
                               FontStyle="Italic" Foreground="Gray" TextWrapping="Wrap" Margin="20,0,0,0"/>
                </StackPanel>
            </GroupBox>

            <!-- Kameror -->
            <GroupBox Grid.Row="2" Header="Kameror och webhooks" Padding="12" Margin="0,0,0,10">
                <StackPanel Orientation="Horizontal">
                    <Button x:Name="BtnAddCamera" Click="BtnAddCamera_Click" Margin="0,0,8,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="âž•" FontSize="14" Margin="0,0,4,0"/>
                            <TextBlock Text="LÃ¤gg till kamera"/>
                        </StackPanel>
                    </Button>
                    <Button x:Name="BtnRefreshFromApi" Click="BtnRefreshFromApi_Click" Margin="0,0,8,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ”„" FontSize="14" Margin="0,0,4,0"/>
                            <TextBlock Text="HÃ¤mta lista frÃ¥n Milestone"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </GroupBox>

            <DataGrid x:Name="DgCameras" Grid.Row="3" Margin="0,0,0,10"
                      AutoGenerateColumns="False" CanUserAddRows="False" CanUserDeleteRows="False"
                      SelectionMode="Single" SelectionChanged="DgCameras_SelectionChanged"
                      HeadersVisibility="Column" GridLinesVisibility="Horizontal"
                      MinHeight="150">
                <DataGrid.Columns>
                    <DataGridCheckBoxColumn Header="Aktiverad" Binding="{Binding Enabled}" Width="70" CanUserResize="False"/>
                    <DataGridTextColumn Header="Kamera" Binding="{Binding CameraName}" Width="180" IsReadOnly="True" CanUserResize="True"/>
                    <DataGridTextColumn Header="HÃ¤ndelsetyp" Binding="{Binding EventTypeName}" Width="150" IsReadOnly="True" CanUserResize="True"/>
                    <DataGridTextColumn Header="Larm" Binding="{Binding IoSourceName}" Width="120" IsReadOnly="True" CanUserResize="True"/>
                    <DataGridTextColumn Header="Webhook-URL" Binding="{Binding WebhookUrl}" Width="*" MinWidth="150" IsReadOnly="True" CanUserResize="True"/>
                    <DataGridTemplateColumn Header="Ã…tgÃ¤rder" Width="120" MinWidth="120" CanUserResize="False">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <Button Content="âœï¸" Click="BtnEditCamera_Click" Tag="{Binding}" Padding="4,2" Margin="2,0" ToolTip="Redigera" FontSize="12" MinWidth="30"/>
                                    <Button Content="ðŸ—‘ï¸" Click="BtnRemoveCamera_Click" Tag="{Binding}" Padding="4,2" Margin="2,0" ToolTip="Ta bort" FontSize="12" MinWidth="30"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>

            <!-- Start / Status -->
            <Border Grid.Row="4" Background="#F8F8F8" BorderBrush="#E0E0E0" BorderThickness="0,1,0,0" Padding="12,10">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock x:Name="TbStatus" Text="Spara anslutningsuppgifter och konfigurera kameror. Starta sedan bryggan." 
                               VerticalAlignment="Center" TextWrapping="Wrap" Margin="0,0,12,0" Foreground="#666"/>
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <Button x:Name="BtnSaveConfig" Click="BtnSaveConfig_Click" Margin="0,0,6,0">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ’¾" FontSize="14" Margin="0,0,4,0"/>
                                <TextBlock Text="Spara"/>
                            </StackPanel>
                        </Button>
                        <Button x:Name="BtnStartBridge" Click="BtnStartBridge_Click" Margin="0,0,6,0">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="â–¶ï¸" FontSize="14" Margin="0,0,4,0"/>
                                <TextBlock Text="Starta brygga"/>
                            </StackPanel>
                        </Button>
                        <Button x:Name="BtnStopBridge" Click="BtnStopBridge_Click" IsEnabled="False">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="â¹ï¸" FontSize="14" Margin="0,0,4,0"/>
                                <TextBlock Text="Stoppa"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>

        <!-- Resize splitter -->
        <GridSplitter x:Name="LogSplitter" Grid.Column="1" HorizontalAlignment="Stretch" Background="LightGray" Grid.RowSpan="6"/>

        <!-- HÃ¶ger panel: Logg -->
        <Border Grid.Column="2" BorderBrush="#CCCCCC" BorderThickness="1" Background="White" Grid.RowSpan="6">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Header med minimera-knapp -->
                <Border Grid.Row="0" Background="#F8F8F8" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1" Padding="8,6">
                    <Grid>
                        <TextBlock x:Name="TbLogHeader" Text="Brygga-log" FontWeight="SemiBold" VerticalAlignment="Center"/>
                        <Button x:Name="BtnToggleLog" Click="BtnToggleLog_Click" 
                                HorizontalAlignment="Right" 
                                VerticalAlignment="Center"
                                Width="24"
                                Height="24"
                                Padding="0"
                                Background="Transparent"
                                BorderThickness="0"
                                Cursor="Hand"
                                ToolTip="Minimera konsoll">
                            <TextBlock x:Name="TbToggleIcon" Text="â—€" FontSize="12" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="#666"/>
                        </Button>
                    </Grid>
                </Border>
                
                <ScrollViewer x:Name="LogScrollViewer" Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
                    <TextBox x:Name="TbBridgeLog" IsReadOnly="True" 
                             TextWrapping="Wrap" 
                             FontFamily="Consolas" 
                             FontSize="11"
                             Background="#1E1E1E"
                             Foreground="#D4D4D4"
                             BorderThickness="0"
                             Padding="8"/>
                </ScrollViewer>
                
                <!-- Footer med rensa-knapp -->
                <Border Grid.Row="2" Background="#F8F8F8" BorderBrush="#E0E0E0" BorderThickness="0,1,0,0" Padding="8,4">
                    <Button x:Name="BtnClearLog" Content="Rensa logg" Click="BtnClearLog_Click" 
                            HorizontalAlignment="Right" 
                            Padding="8,4"
                            MinWidth="80"
                            Background="White"
                            BorderBrush="#CCCCCC"
                            BorderThickness="1"/>
                </Border>
            </Grid>
        </Border>
    </Grid>
</Window>
